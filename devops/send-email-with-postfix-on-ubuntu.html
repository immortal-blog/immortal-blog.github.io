<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Send email with postfix on Ubuntu | Immortal Blog</title>
  <meta name="author" content="immortalt">
  
  <meta name="description" content="An awesome blog about software development and network security.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Send email with postfix on Ubuntu"/>
  <meta property="og:site_name" content="Immortal Blog"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism-line-numbers.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <link id="modern-theme-css" rel="stylesheet" href="/css/modern-improvements.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  <script src="/js/theme-switcher.js"></script>
  
  <!-- analytics -->
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZJT0X50ELX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-ZJT0X50ELX');
</script>



<meta name="generator" content="Hexo 6.0.0"></head>

 <body>
   

  <script type="text/javascript">
    (function(window, document, dataLayerName, id) {
    window[dataLayerName]=window[dataLayerName]||[],window[dataLayerName].push({start:(new Date).getTime(),event:"stg.start"});var scripts=document.getElementsByTagName('script')[0],tags=document.createElement('script');
    function stgCreateCookie(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toUTCString()}document.cookie=a+"="+b+d+"; path=/"}
    var isStgDebug=(window.location.href.match("stg_debug")||document.cookie.match("stg_debug"))&&!window.location.href.match("stg_disable_debug");stgCreateCookie("stg_debug",isStgDebug?1:"",isStgDebug?14:-1);
    var qP=[];dataLayerName!=="dataLayer"&&qP.push("data_layer_name="+dataLayerName),isStgDebug&&qP.push("stg_debug");var qPString=qP.length>0?("?"+qP.join("&")):"";
    tags.async=!0,tags.src="https://immortalt.containers.piwik.pro/"+id+".js"+qPString,scripts.parentNode.insertBefore(tags,scripts);
    !function(a,n,i){a[n]=a[n]||{};for(var c=0;c<i.length;c++)!function(i){a[n][i]=a[n][i]||{},a[n][i].api=a[n][i].api||function(){var a=[].slice.call(arguments,0);"string"==typeof a[0]&&window[dataLayerName].push({event:n+"."+i+":"+a[0],parameters:[].slice.call(arguments,1)})}}(i[c])}(window,"ppms",["tm","cm"]);
    })(window, document, 'dataLayer', '09a725f9-52e4-49d0-9691-6ccab4f70092');
    </script><noscript><iframe src="https://immortalt.containers.piwik.pro/09a725f9-52e4-49d0-9691-6ccab4f70092/noscript.html" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Immortal Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		</ul>
		<ul class="nav navbar-nav navbar-right">
		  <li>
			<a href="#" id="theme-toggle-btn" title="Switch between modern and retro themes">
			  <i class="fa fa-refresh"></i>Retro Theme
			</a>
		  </li>
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Send email with postfix on Ubuntu</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>This method consolidates common fixes from multiple tutorials and worked for me.</p>
<h2 id="Install-mailutils"><a href="#Install-mailutils" class="headerlink" title="Install mailutils"></a>Install mailutils</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mailutils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Configure-username-and-password"><a href="#Configure-username-and-password" class="headerlink" title="Configure username and password"></a>Configure username and password</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/postfix/sasl_passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Input SMTP server, account and password.</p>
<pre class="line-numbers language-none"><code class="language-none">[smtp.126.com]:465 username@126.com:password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>The password of the 126 mailbox needs to generate an authorization code in the settings.<br>Then run postmap.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> /etc/postfix/sasl_passwd
<span class="token function">sudo</span> postmap /etc/postfix/sasl_passwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<span id="more"></span>

<h2 id="Map-sender"><a href="#Map-sender" class="headerlink" title="Map sender"></a>Map sender</h2><p>By default, postfix uses your username@hostname (the one you can see in the title bar of the Ubuntu Console window) to send emails. Such emails will be rejected by the smtp server (553 Mail from must equal authorized user), so you need to put it mapped to your real email address.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/postfix/generic<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Write mapping.</p>
<pre class="line-numbers language-none"><code class="language-none">root@ubuntu     username@126.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Then run postmap.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> /etc/postfix/generic
<span class="token function">sudo</span> postmap /etc/postfix/generic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Modify-the-configuration-file"><a href="#Modify-the-configuration-file" class="headerlink" title="Modify the configuration file"></a>Modify the configuration file</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/postfix/main.cf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>edit <code>relayhost</code>.</p>
<pre class="line-numbers language-none"><code class="language-none">relayhost &#x3D; [smtp.126.com]:465<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Add the following configuration at the end of the file.</p>
<pre class="line-numbers language-none"><code class="language-none"># enable SASL authentication
smtp_sasl_auth_enable &#x3D; yes

# disallow methods that allow anonymous authentication.
smtp_sasl_security_options &#x3D; noanonymous

# where to find sasl_passwd
smtp_sasl_password_maps &#x3D; hash:&#x2F;etc&#x2F;postfix&#x2F;sasl_passwd

# where to find generic
smtp_generic_maps &#x3D; hash:&#x2F;etc&#x2F;postfix&#x2F;generic

# Enable STARTTLS encryption
smtp_use_tls &#x3D; yes

# where to find CA certificates
smtp_tls_CAfile &#x3D; &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;ca-certificates.crt

# Enable tls encryption
smtp_tls_wrappermode &#x3D; yes
smtp_tls_security_level &#x3D; encrypt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Note: Port 465 is SMTPS (implicit TLS). If you use port 587 instead, disable <code>smtp_tls_wrappermode</code> and use STARTTLS.</p>
<h2 id="Send-email"><a href="#Send-email" class="headerlink" title="Send email"></a>Send email</h2><p>Then restart postfix and you can send emails.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> postfix restart
<span class="token builtin class-name">echo</span> <span class="token string">"test"</span> <span class="token operator">|</span> mail -s <span class="token string">"hello"</span> target@126.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="View-running-log"><a href="#View-running-log" class="headerlink" title="View running log"></a>View running log</h2><p>If there is no response after running, see if there is any error in the log, so as to search and solve the problem in a targeted manner. You can open a separate terminal and place it next to it to view the log in real time.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tail</span> -f /var/log/mail.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

	  
	  <hr>
	  <p>Content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a>.</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/devops/how-to-detect-and-solve-port-occupancy-in-linux.html" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/devops/create-socks-server-on-ubuntu20.04.html" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
    <section id="comment">
      <h2 class="title">Comments</h2>
      
         <script>
           // Determine theme based on user preference
           const savedTheme = localStorage.getItem('hexo-theme-preference') || 'modern';
           const utterancesTheme = savedTheme === 'modern'
             ? 'github-light'
             : 'photon-dark';

           // Create and configure utterances script
           const utterancesScript = document.createElement('script');
           utterancesScript.src = 'https://utteranc.es/client.js';
           utterancesScript.setAttribute('repo', 'immortal-blog/immortal-blog.github.io');
           utterancesScript.setAttribute('issue-term', 'pathname');
           utterancesScript.setAttribute('theme', utterancesTheme);
           utterancesScript.setAttribute('crossorigin', 'anonymous');
           utterancesScript.async = true;

           document.getElementById('comment').appendChild(utterancesScript);
         </script>
      
    </section>
    
    
	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2022-02-08 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/devops/">devops<span>13</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/devops/">devops<span>12</span></a></li> <li><a href="/tags/ubuntu/">ubuntu<span>7</span></a></li> <li><a href="/tags/linux/">linux<span>7</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Install-mailutils"><span class="toc-article-text">Install mailutils</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Configure-username-and-password"><span class="toc-article-text">Configure username and password</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Map-sender"><span class="toc-article-text">Map sender</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Modify-the-configuration-file"><span class="toc-article-text">Modify the configuration file</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Send-email"><span class="toc-article-text">Send email</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#View-running-log"><span class="toc-article-text">View running log</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2026 immortalt
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>, <a href="https://github.com/wzpan/hexo-theme-freemind" target="_blank">freemind</a> and <a href="https://github.com/blackshow/hexo-theme-freemind.386" target="_blank">freemind.386</a>.
     <br> Theme by <a target="_blank" rel="noopener" href="https://github.com/immortal-blog/hexo-theme-freemind.386.plus">Freemind.386.plus</a>.
     <br> Content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a>.
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
